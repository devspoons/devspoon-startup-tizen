[domain]

; ==========================================
; PHP-FPM 풀 설정 (프로덕션 서비스용 샘플)
; ==========================================

; -------------------------------------------------
; 프로세스 소유자 설정 - 웹서버 프로세스와 일치시켜야 함
; 보안상 root로 실행하지 않도록 주의
user = www-data
group = www-data

; -------------------------------------------------
; 리스닝 소켓 또는 포트 설정
; TCP 포트(9000) 혹은 유닉스 소켓을 선택 가능
; 유닉스 소켓이 더 빠르며, 단일 서버 내부 통신에 권장
listen = [::]:portnumber
; listen = /run/php/php-fpm.sock

; -------------------------------------------------
; 소켓 퍼미션 설정 (소켓 모드로 사용할 경우 활성화)
; 권한 문제 발생 시 주석 해제하여 조정
; listen.owner = www-data
; listen.group = www-data
; listen.mode = 0660

; -------------------------------------------------
; 프로세스 관리 방식 및 리소스 설정
; dynamic: 요청량에 따라 프로세스 개수를 유연하게 조정
pm = dynamic
pm.max_children = 50         ; 동시에 처리 가능한 최대 요청 수
pm.start_servers = 5         ; 초기 구동 시 프로세스 개수
pm.min_spare_servers = 5     ; 유휴 상태 최소 프로세스
pm.max_spare_servers = 35    ; 유휴 상태 최대 프로세스
pm.process_idle_timeout = 10s ; 유휴 프로세스 종료 대기시간
pm.max_requests = 200        ; 워커당 최대 처리 요청 수 (메모리 누수 방지용)

; -------------------------------------------------
; 환경변수 초기화 설정
; clear_env=no로 설정하면 시스템 환경변수 사용 가능 (예: PATH)
clear_env = no

; -------------------------------------------------
; PHP 런타임 제어 (보안 및 성능 관련)
php_admin_value[session.cookie_httponly] = 1    ; XSS 방지를 위한 세션 쿠키 보호
catch_workers_output = yes                      ; PHP 에러를 워커 로그로 전달
php_admin_flag[log_errors] = on                 ; PHP 오류 로그 활성화
php_admin_value[error_log] = /log/php-fpm/www-error.log ; 오류 로그 경로

; -------------------------------------------------
; 액세스 로그 설정
; 요청별 로그를 남겨 요청 추적 및 디버깅에 유용
access.log = /log/php-fpm/access.log

; -------------------------------------------------
; 느린 요청 추적 로그 (성능 이슈 진단용)
; 활성화 추천: 트래픽이 많을 경우 병목 구간 파악용
; slowlog = /log/php-fpm/slow.log
; request_slowlog_timeout = 5s

; -------------------------------------------------
; PHP 리소스 제한 (필요 시 활성화)
; 대용량 업로드나 긴 실행시간이 필요한 경우 조정
; php_admin_value[memory_limit] = 256M
; php_admin_value[max_execution_time] = 120
; php_admin_value[max_input_time] = 300
; php_admin_value[post_max_size] = 25M
; php_admin_value[upload_max_filesize] = 25M
